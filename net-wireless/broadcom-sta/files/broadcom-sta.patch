--- /portable/portdir/net-wireless/broadcom-sta/broadcom-sta-5.100.82.112-r2.ebuild	2012-05-22 05:01:23.000000000 +0200
+++ broadcom-sta-5.100.82.112-r3.ebuild	2012-10-15 19:10:40.525274604 +0200
@@ -31,7 +31,11 @@
 	# make checks non-fatal. The correct fix is blackisting ssb and, perhaps
 	# b43 via udev rules. Moreover, previous fix broke binpkgs support.
 	CONFIG_CHECK="~!B43 ~!SSB"
-	if kernel_is ge 2 6 32; then
+	BUILD_PARAMS=""
+	if kernel_is ge 3 6 0; then
+		CONFIG_CHECK="${CONFIG_CHECK} LIB80211 WIRELESS_EXT ~!MAC80211 LIB80211_CRYPT_TKIP"
+		BUILD_PARAMS="API=WEXT"
+	elif kernel_is ge 2 6 32; then
 		CONFIG_CHECK="${CONFIG_CHECK} CFG80211 LIB80211 ~!MAC80211"
 	elif kernel_is ge 2 6 31; then
 		CONFIG_CHECK="${CONFIG_CHECK} LIB80211 WIRELESS_EXT ~!MAC80211"
@@ -42,7 +46,7 @@
 	fi
 	linux-mod_pkg_setup

-	BUILD_PARAMS="-C ${KV_DIR} M=${S}"
+	BUILD_PARAMS="-C ${KV_DIR} M=${S} ${BUILD_PARAMS}"
 	BUILD_TARGETS="wl.ko"
 }
